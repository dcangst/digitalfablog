{% load i18n %}
{% load mathfilters %}
<table class="table table-sm table-reflow">
  <thead>
    <tr>
      <th>{% trans "Item" %}</th>
      <th>{% trans "Duration" %}</th>
      <th class="text-right">{% trans "Price" %}</th>
    </tr>
  </thead>
  <tbody>
    {% for machinesused in fablog.machinesused_set.all %}
      <tr>
        <td>
          <span 
            class="badge badge-secondary"
            style="background:{{ machinesused.machine.color }}">
            {{ machinesused.machine.abbreviation }}
          </span>
          {{ machinesused.machine.name }}
        </td>
        <td>
          {% if machinesused.end_time %}
            {{ machinesused.duration_str }}
          {% else %}
            <span name="countup" data-countup= "{{ machinesused.start_time|date:'c' }}"></span>
          {% endif %}
        </td>
        <td align="right">
          {{ machinesused.amount }}
        </td>
      </tr>
    {% endfor %}
    {% if fablog.machinesused_set.all %}
      <tr>
        <td colspan="2" align="right">
          <em>{% trans "Subtotal machines" %}</em>
        </td>
        <td class="border-top border-dark" align="right">
          <em>{{fablog.total_machines}}<em>
        </td>
      </tr>
    {% endif %}
    {% for varia in fablog.fablogvaria_set.all %}
        <tr>
          <td  colspan="2" align="left">
            {{varia.units}} x {{ varia.details }}
          </td>
          <td align="right">
            {{varia.amount}}
          </td>
        </tr>
    {% endfor %}
    {% if fablog.fablogvaria_set.all %}
      <tr>
        <td colspan="2" align="right">
          <em>{% trans "Subtotal varia" %}</em>
        </td>
        <td class="border-top border-dark" align="right">
          <em>{{fablog.total_varia}}</em>
        </td>
      </tr>
    {% endif %}
    {% for fablogmembership in fablog.fablogmemberships_set.all %}
        <tr>
          <td colspan="2" align="left">
            {{fablogmembership.membership_type.name}} {% trans "until" %} {{ fablogmembership.end_date }}
          </td>
          <td align="right">
            {{fablogmembership.amount}}
          </td>
        </tr>
    {% endfor %}
    {% if fablog.fablogmemberships_set.all %}
      <tr>
        <td colspan="2" align="right">
          <em>{% trans "Subtotal memberships" %}</em>
        </td>
        <td class="border-top border-dark" align="right">
          <em>{{fablog.total_memberships}}</em>
        </td>
      </tr>
    {% endif %}
    {% for refund in fablog.fablogrefunds_set.all %}
        <tr>
          <td colspan="2" align="left">
            {{refund.details}}
          </td>
          <td align="right">
            {{refund.amount|mul:-1}}
          </td>
        </tr>
    {% endfor %}
    {% if fablog.fablogrefunds_set.all %}
      <tr>
        <td colspan="2" align="right">
          <em>{% trans "Subtotal refunds" %}</em>
        </td>
        <td class="border-top border-dark" align="right">
          <em>{{fablog.total_refunds|mul:-1}}</em>
        </td>
      </tr>
    {% endif %}
    <tr>
      <td colspan="2" align="right">
        <b>{% trans "Total" %}</b>
      </td>
      <td class="border-top border-dark" align="right">
        <b>{{fablog.total}}</b>
      </td>
    </tr>
    {% for transaction in fablog.fablogtransactions_set.all %}
        <tr>
          <td colspan="2" align="left">
            {{ transaction.transaction }}
          </td>
          <td align="right">
            {{ transaction.amount|mul:-1 }}
          </td>
        </tr>
    {% endfor %}
    <tr>
      <td colspan="2" align="right">
        <b>{% trans "Due" %}</b>
      </td>
      <td class="border-top border-dark" align="right">
        <b>{{fablog.dues}}</b>
      </td>
    </tr>
  </tbody>
</table>
